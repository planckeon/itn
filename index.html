<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Imagining the Neutrino</title>
    <!-- Chota CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chota@latest/dist/chota.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/src/style.css" />

    <!-- Import main script -->
    <script type="module" src="/src/main.ts"></script>
  </head>
  <body> <!-- Removed class="dark" as background will be set by p5 -->
    <main x-data="neutrinoVisualization()" x-cloak>
         <!-- Main p5.js Container (Visualization - full viewport) -->
         <!-- The single p5 sketch will create its canvas inside this div -->
         <div id="p5-container">
             <!-- The p5 canvas will be created here by the sketch -->
         </div> <!-- End p5 Container -->

         <!-- Top Control Overlay -->
         <div id="top-overlay" class="is-dark overlay-panel">
             <!-- Controls content goes here, structured similar to inspirational screenshots -->
             <div class="flex items-center justify-between px-2 py-1">
                 <!-- Initial Flavor and Energy -->
                 <div class="flex items-center">
                     <label for="initialFlavor" class="text-small mr-1">Initial Flavor:</label>
                     <select x-model.number="simParams.initialFlavorIndex" @change="updateVisualization()" id="initialFlavor" class="select-small mr-2">
                         <option value="0">Electron (νe)</option>
                         <option value="1">Muon (νμ)</option>
                         <option value="2">Tau (ντ)</option>
                     </select>
                     <label for="energyInput" class="text-small mr-1">Energy (GeV):</label>
                      <div class="flex items-center">
                         <input type="number" x-model.number="simParams.energy" @input="requestPlotUpdate()" min="-10" max="10" step="0.05" id="energyInput" class="input-number input-number-small" style="width: 60px;">
                          <span class="tooltip-container ml-1" @click.stop="toggleTooltip('energyTooltip')">
                             <span class="tooltip-icon small-icon">?</span>
                              <span class="tooltip-content" data-tooltip-id="energyTooltip" x-show="tooltipState.visible.energyTooltip" @click.outside="hideTooltip('energyTooltip')">
                                 <h4>Neutrino Energy</h4>
                                 <p>The neutrino's energy (E). Oscillation length <span x-katex="'L_{osc} \\\\propto E / \\\\Delta m^2'"></span>. Matter effects also depend on E.</p>
                                 <p>Use negative E for antineutrinos (<span x-katex="'\\\\bar{\\\\nu}'"></span>).</p>
                             </span>
                          </span>
                       </div>
                  </div>

                 <!-- Speed -->
                 <div class="flex items-center hide-sm">
                     <label for="simSpeed" class="text-small mr-1">Speed:</label>
                      <input type="range" x-model.number="animState.simSpeed" min="0.1" max="10" step="0.1" id="simSpeed" style="width: 80px;">
                      <span x-text="animState.simSpeed ? animState.simSpeed.toFixed(1) + 'x' : '1.0x'" class="value-display text-small ml-1">1.0x</span>
                  </div>

                  <!-- Matter Effect -->
                  <div class="flex items-center mr-2 mb-0">
                    <label for="matterToggle" class="mr-1 mb-0 text-small">Matter effect:</label>
                    <input type="checkbox" x-model="simParams.matterEffect" @change="updateVisualization()" id="matterToggle" class="mb-0">
                    <span class="tooltip-container ml-1" @click.stop="toggleTooltip('matterTooltip')">
                         <span class="tooltip-icon small-icon">?</span>
                         <span class="tooltip-content" data-tooltip-id="matterTooltip" x-show="tooltipState.visible.matterTooltip" @click.outside="hideTooltip('matterTooltip')">
                             <h4>Matter Effects (MSW)</h4>
                             <p>Toggles the calculation between vacuum oscillations and oscillations within matter (MSW effect).</p>
                             <p>The effective Hamiltonian includes an additional potential term:</p>
                             <div class="display" x-katex="'H_{eff} = H_{vac} + diag(V_{CC}, 0, 0)'"></div>
                             <p>Where <span x-katex="'V_{CC} = \\sqrt{2}G_F n_e'"></span> depends on electron density <span x-katex="'n_e'"></span>.</p>
                             <p>This generates the Wolfenstein potential:</p>
                             <div class="display" x-katex="'A [\\text{eV}^2] \\approx 7.6 \\times 10^{-5} \\times Y_e \\times (\\rho) \\times (E [\\text{GeV}])'"></div>
                             <p>Earth: Crust ~2.7, Avg ~5.5, Core ~13 g/cm³.</p>
                         </span>
                     </span>
                </div>
                 <!-- Density -->
                <template x-if="simParams.matterEffect">
                    <div class="form-group mr-2 mb-0">
                        <label for="matterDensityInput" class="text-small mb-0">ρ [g/cm³]:</label>
                         <div class="flex items-center">
                             <input type="number" x-model.number="simParams.rho" @input="requestPlotUpdate()" min="0" max="20" step="0.1" id="matterDensityInput" class="input-number input-number-small" style="width: 50px;">
                             <span class="tooltip-container ml-1" @click.stop="toggleTooltip('densityTooltip')">
                                <span class="tooltip-icon small-icon">?</span>
                                <span class="tooltip-content right-aligned" data-tooltip-id="densityTooltip" x-show="tooltipState.visible.densityTooltip" @click.outside="hideTooltip('densityTooltip')">
                                    <h4>Matter Density</h4>
                                    <p>The average electron density (<span x-katex="'n_e = \\rho N_A Y_e / A'"></span>) of the medium, specified via mass density <span x-katex="'\\rho'"></span> in g/cm³. Assumes constant density and <span x-katex="'Y_e=0.5'"></span>.</p>
                                    <p>This generates the Wolfenstein potential:</p>
                                    <div class="display" x-katex="'A [\\text{eV}^2] \\approx 7.6 \\times 10^{-5} \\times Y_e \\times (\\rho) \\times (E [\\text{GeV}])'"></div>
                                    <p>Earth: Crust ~2.7, Avg ~5.5, Core ~13 g/cm³.</p>
                                </span>
                             </span>
                         </div>
                     </div>
                 </template>
                  <!-- Max Distance for Plot -->
                  <div class="form-group mr-2 mb-0">
                      <label for="maxLInput" class="text-small mb-0">L<sub>max</sub> [km]:</label>
                      <div class="flex items-center">
                           <input type="number" x-model.number="plotParams.maxL" @input="requestPlotUpdate()" min="100" max="5000" step="50" id="maxLInput" class="input-number input-number-small" style="width: 70px;">
                           <span class="tooltip-container ml-1" @click.stop="toggleTooltip('maxLTooltip')">
                             <span class="tooltip-icon small-icon">?</span>
                             <span class="tooltip-content" data-tooltip-id="maxLTooltip" x-show="tooltipState.visible.maxLTooltip" @click.outside="hideTooltip('maxLTooltip')">
                                 <h4>Plot Max Distance</h4>
                                 <p>Sets the maximum distance shown on the probability plot. The 3D animation loops over this distance.</p>
                             </span>
                           </span>
                       </div>
                   </div>
                     <!-- Mixing Parameters (Details/Summary) -->
                    <!-- Mixing Parameters moved to separate panel -->

                  <!-- Play/Pause/Reset Buttons -->
                   <div class="flex items-center ml-2">
                        <button class="button outline small mr-1" @click="playPause()">
                            <span x-text="animState.isPlaying ? 'Pause' : 'Play'">Play</span>
                        </button>
                        <button class="button outline small" @click="reset()">Reset</button>
                   </div>


             </div>

              <!-- Mixing Parameters and other less frequent controls - can be in a separate expandable section or dialog -->
              <!-- For now, simplifying and putting only main controls in top overlay -->
               <!-- Need to decide where to put Density, MaxL, and Mixing Params -->
               <!-- Let's put them in a separate panel below the top bar, still overlaid -->
           </div> <!-- End Top Overlay -->


           <!-- Neutrino Flavor Label Overlay (Positioned absolutely at top-right) -->
            <div id="neutrino-flavor-label" class="neutrino-flavor-label-style overlay-panel">
               <!-- Flavor label will be updated by p5 sketch -->
               <span>Loading...</span>
            </div>

           <!-- Canvas for Probability Plot Overlay (Positioned at the bottom center) -->
            <canvas id="probPlotCanvas" class="p5-plot-canvas is-dark overlay-panel"></canvas>
            <!-- Mixing Parameters Panel Overlay (Bottom Right) -->
            <div id="mixing-params-panel" class="overlay-panel is-dark">
                <h4 class="text-small mb-1">Mixing Parameters</h4>
                <!-- theta12 -->
                <div class="form-group">
                    <label for="theta12Input" class="text-small mb-0">θ<sub>12</sub> [deg]:</label>
                    <div class="flex items-center">
                        <input type="number" x-model.number="simParams.theta12_deg" @input="requestPlotUpdate()" min="0" max="90" step="0.1" class="input-number input-number-small" style="width: 60px;">
                        <span class="tooltip-container ml-1" @click.stop="toggleTooltip('theta12Tooltip')">
                            <span class="tooltip-icon small-icon">?</span>
                            <span class="tooltip-content" data-tooltip-id="theta12Tooltip" x-show="tooltipState.visible.theta12Tooltip" @click.outside="hideTooltip('theta12Tooltip')">
                                <h4>Solar Angle θ<sub>12</sub></h4>
                                <p>Controls mixing between mass states 1 and 2. Primarily affects solar neutrinos. Value ~33.4°.</p>
                                <span class="display" x-katex="'P_{ee}^{sun} \\approx c_{13}^4 (1 - \\sin^2(2\\theta_{12}) \\sin^2(\\Delta_{21}))'"></span>
                            </span>
                        </span>
                    </div>
                </div>
                <!-- theta23 -->
                <div class="form-group">
                    <label for="theta23Input" class="text-small mb-0">θ<sub>23</sub> [deg]:</label>
                    <div class="flex items-center">
                        <input type="number" x-model.number="simParams.theta23_deg" @input="requestPlotUpdate()" min="0" max="90" step="0.1" class="input-number input-number-small" style="width: 60px;">
                        <span class="tooltip-container ml-1" @click.stop="toggleTooltip('theta23Tooltip')">
                            <span class="tooltip-icon small-icon">?</span>
                            <span class="tooltip-content" data-tooltip-id="theta23Tooltip" x-show="tooltipState.visible.theta23Tooltip" @click.outside="hideTooltip('theta23Tooltip')">
                                <h4>Atmospheric Angle θ<sub>23</sub></h4>
                                <p>Controls mixing between mass states 2 and 3. Primarily affects atmospheric/LBL <span x-katex="'\\nu_\\mu \\leftrightarrow \\nu_\\tau'"></span> oscillations. Value near 45° (maximal mixing).</p>
                                <span class="display" x-katex="'P_{\\mu\\mu}^{atm} \\approx 1 - \\sin^2(2\\theta_{23}) \\sin^2(\\Delta_{31(32)}))'"></span>
                            </span>
                        </span>
                    </div>
                </div>
                <!-- theta13 -->
                <div class="form-group">
                    <label for="theta13Input" class="text-small mb-0">θ<sub>13</sub> [deg]:</label>
                    <div class="flex items-center">
                        <input type="number" x-model.number="simParams.theta13_deg" @input="requestPlotUpdate()" min="0" max="15" step="0.01" class="input-number input-number-small" style="width: 60px;">
                        <span class="tooltip-container ml-1" @click.stop="toggleTooltip('theta13Tooltip')">
                            <span class="tooltip-icon small-icon">?</span>
                            <span class="tooltip-content" data-tooltip-id="theta13Tooltip" x-show="tooltipState.visible.theta13Tooltip" @click.outside="hideTooltip('theta13Tooltip')">
                                <h4>Reactor Angle θ<sub>13</sub></h4>
                                <p>Links all three generations. Measured relatively recently (~8.5°). Crucial for CP violation and mass ordering sensitivity.</p>
                                <span class="display" x-katex="'P_{ee}^{reactor} \\approx 1 - \\sin^2(2\\theta_{13}) \\sin^2(\\Delta_{31(32)}))'"></span>
                            </span>
                        </span>
                    </div>
                </div>
                <!-- deltaCP -->
                <div class="form-group">
                    <label for="deltaCPInput" class="text-small mb-0">δ<sub>CP</sub> [deg]:</label>
                    <div class="flex items-center">
                        <input type="number" x-model.number="simParams.deltaCP_deg" @input="requestPlotUpdate()" min="0" max="360" step="1" class="input-number input-number-small" style="width: 60px;">
                        <span class="tooltip-container ml-1 right-aligned" @click.stop="toggleTooltip('deltaCPTooltip')">
                            <span class="tooltip-icon small-icon">?</span>
                            <span class="tooltip-content right-aligned" data-tooltip-id="deltaCPTooltip" x-show="tooltipState.visible.deltaCPTooltip" @click.outside="hideTooltip('deltaCPTooltip')">
                                <h4>CP Phase δ<sub>CP</sub></h4>
                                <p>The Dirac CP-violating phase. A value <span x-katex="'\\ne 0, 180^\\circ'"></span> causes <span x-katex="'P(\\nu_\\alpha \\to \\nu_\\beta) \\ne P(\\bar{\\nu}_\\alpha \\to \\bar{\\nu}_\\beta)'"></span>. Current best fit ~195°.</p>
                            </span>
                        </span>
                    </div>
                </div>
                <!-- dm21sq -->
                <div class="form-group">
                    <label for="dm21sqInput" class="text-small mb-0">Δm²<sub>21</sub> [10⁻⁵ eV²]:</label>
                    <div class="flex items-center">
                        <input type="number" :value="simParams.dm21sq_eV2 * 1e5" @input="simParams.dm21sq_eV2 = $event.target.value / 1e5; requestPlotUpdate()" min="1" max="15" step="0.01" class="input-number input-number-small" style="width: 60px;">
                        <span class="tooltip-container ml-1" @click.stop="toggleTooltip('dm21Tooltip')">
                            <span class="tooltip-icon small-icon">?</span>
                            <span class="tooltip-content" data-tooltip-id="dm21Tooltip" x-show="tooltipState.visible.dm21Tooltip" @click.outside="hideTooltip('dm21Tooltip')">
                                <h4>Solar Mass Splitting Δm²<sub>21</sub></h4>
                                <p>The smaller mass-squared difference (<span x-katex="'m_2^2 - m_1^2'"></span>). Primarily drives solar/reactor <span x-katex="'\\nu_e'"></span> disappearance. Value ~<span x-katex="'7.4 \\times 10^{-5} \\text{ eV}^2'"></span>.</p>
                            </span>
                        </span>
                    </div>
                </div>
                <!-- dm31sq -->
                <div class="form-group">
                    <label for="dm31sqInput" class="text-small mb-0">Δm²<sub>31</sub> [10⁻³ eV²]:</label>
                    <div class="flex items-center">
                        <input type="number" :value="simParams.dm31sq_eV2 * 1e3" @input="simParams.dm31sq_eV2 = $event.target.value / 1e3; requestPlotUpdate()" min="-4" max="4" step="0.01" class="input-number input-number-small" style="width: 60px;">
                        <span class="tooltip-container ml-1 right-aligned" @click.stop="toggleTooltip('dm31Tooltip')">
                            <span class="tooltip-icon small-icon">?</span>
                            <span class="tooltip-content right-aligned" data-tooltip-id="dm31Tooltip" x-show="tooltipState.visible.dm31Tooltip" @click.outside="hideTooltip('dm31Tooltip')">
                                <h4>Atmospheric Mass Splitting Δm²<sub>31</sub></h4>
                                <p>The larger mass-squared difference (<span x-katex="'m_3^2 - m_1^2'"></span>). Primarily drives atmospheric/LBL <span x-katex="'\\nu_\\mu'"></span> disappearance. Value ~<span x-katex="'2.5 \\times 10^{-3} \\text{ eV}^2'"></span>. Sign determines mass ordering (NO: +, IO: -).</p>
                            </span>
                        </span>
                    </div>
                </div>
            </div> <!-- End Mixing Params Panel -->



        </main>
       </body>
    </html>


# High-Level Design: Imagining the Neutrino\n\n## 1. Introduction\nThis document outlines the high-level design for the \"Imagining the Neutrino\" web application, focusing on its main features, components, and user interactions.\n\n## 2. Goals\n*   Visualize 3-flavor neutrino oscillation probabilities in vacuum and matter.\n*   Provide an interactive 3D animation of a neutrino changing flavor.\n*   Allow user control over key physical parameters (Energy, Lmax, initial flavor, matter density, mixing parameters).\n*   Offer educational context via tooltips and explanations.\n*   Be accurate (using NuFast), performant, and user-friendly.\n*   Deployable as a static website via GitHub Pages.\n\n## 3. Key Features\n*   **Parameter Control Panel:** Sliders, number inputs, dropdowns, and checkboxes to set simulation parameters.\n*   **Probability Plot:** An interactive 2D plot (using Plotly.js) showing P(ν<sub>α</sub> → ν<sub>e</sub>), P(ν<sub>α</sub> → ν<sub>μ</sub>), P(ν<sub>α</sub> → ν<sub>τ</sub>) vs. distance (L) up to Lmax, dynamically updating based on parameters. Includes a marker indicating the current position in the 3D animation.\n*   **3D Neutrino Flight Visualization:** A Three.js scene depicting:\n    *   A particle representing the neutrino, fixed at the center of the view.\n    *   A moving starfield background to simulate travel.\n    *   The neutrino's color dynamically changing based on calculated flavor probabilities [P<sub>e</sub>(L), P<sub>μ</sub>(L), P<sub>τ</sub>(L)] at the current animated distance L.\n    *   OrbitControls allowing the user to rotate the camera view around the neutrino.\n    *   An overlay displaying current distance, probabilities, and dominant flavor.\n*   **Animation Controls:** Play, Pause, Reset buttons for the 3D animation. Simulation speed control.\n*   **Educational Tooltips:** Hover/click interactions on parameter labels providing explanations of their physical significance, including LaTeX formulas rendered with KaTeX.\n*   **Vacuum/Matter Mode:** Toggle to switch between vacuum calculations and calculations in constant-density matter.\n\n## 4. Major Components\n*   **UI Manager (Alpine.js + HTML/CSS):** Handles user input, displays controls, manages tooltip visibility, and reflects the application state.\n*   **State Controller (Alpine.js Store / TS):** Manages the shared state of all adjustable parameters and animation status.\n*   **Physics Calculator (TypeScript Module):** Encapsulates the NuFast-based logic for calculating oscillation probabilities given the state parameters. Provides an API like \`calculateNuFastProbs(params)\`.\n*   **Plot Renderer (Plotly.js Wrapper):** Takes state parameters, calls the Physics Calculator for data points, and renders/updates the 2D probability plot.\n*   **3D Scene Renderer (Three.js Wrapper):** Sets up and manages the Three.js scene, runs the animation loop, interacts with the Physics Calculator to get probabilities for color updates, and handles camera controls.\n\n## 5. User Interaction Flow\n1.  **Load Page:** Default parameters are loaded, initial plot and 3D scene are rendered (animation paused).\n2.  **Adjust Parameter:** User changes a slider (e.g., Energy) or selects an option (e.g., Initial Flavor).\n3.  **State Update:** UI Manager updates the central State Controller (Alpine stores).\n4.  **Plot Update:** Plot Renderer observes state changes, recalculates probabilities via Physics Calculator, and updates the Plotly chart (debounced for sliders).\n5.  **Animation Update (if playing):** 3D Scene Renderer uses the updated parameters in its next animation frame calculation. If parameters like initial flavor change, the animation might reset.\n6.  **Toggle Vacuum/Matter:** User toggles the mode. State Controller updates. Plot Renderer and 3D Scene Renderer switch calculation mode (calling the appropriate physics logic) and update visuals.\n7.  **Control Animation:** User clicks Play/Pause/Reset. State Controller updates \`isPlaying\` flag. 3D Scene Renderer starts/stops/resets the animation loop and visual state.\n8.  **View Tooltip:** User hovers/clicks a parameter label's help icon. UI Manager shows the corresponding tooltip, rendering KaTeX.\n9.  **Rotate 3D View:** User clicks and drags on the 3D canvas. OrbitControls updates the camera position.\n\n## 6. External Interfaces\n*   **Plotly.js:** Used for rendering 2D plots.\n*   **Three.js:** Used for rendering the 3D scene.\n*   **Alpine.js:** Used for UI reactivity and component state.\n*   **Chota.css:** Base CSS styling.\n*   **KaTeX:** Used for rendering LaTeX in tooltips.
